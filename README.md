# Code for OGAM

### Overview

1. Directory *FNS* contains the main functions which are called for the simulations and data applications. Specifically,
- *FNS_DataGene_Simu1* : function to generate data for simulation 1
- *FNS_DataGene_Simu2* : function to generate data for simulation 2
- *FNS_SmoBack* : functions to conduct smoothbackfitting
- *FNS_SmoBack_credit* : differs from *FNS_SmoBack* only in the stopping criterion

2. Directory *datasets* contains the datasets *credit* and *flight* for data applications. Due to the upload restrictions, we provide the preprocessed data here, which are seperated into several parts. Please **merge them before processing**. Raw data are available in the following links:
- *credit* : https://data.mendeley.com/datasets/wb3ndt69gf (P2P_Macro_Data.dta, 3 GB)
- *flight* : https://community.amstat.org/jointscsg-section/dataexpo/dataexpo2009

3. Directory *res* contains the analysis results of the simulations and data applications.

4. Directory *fig* contains the figures generated by the numerical experiments. 

5. Directory *Compare_Code* contains the code for simulation 3 to compare with other online nonparametric methods in the degenerated one-dimensional case.

### Workflows

#### Simulation 1 and 2

1. Make sure that the R scripts ***simulation1.R*** and ***simulation2.R*** are in the same  directory as the folder ***FNS***.
2. As the bandwidth selection is not our focus, users can choose to run Section 1 and 2 of ***supp-bandwidth_selection.R*** to generate the constants for bandwidths or to load them directly in Step 3. If choose to load them, make sure that the following files exist:
- *res/sim1/online_constants_for_bandwidths.Rdata*
- *res/sim1/batch_constants_for_bandwidths.Rdata*
- *res/sim2/online_constants_for_bandwidths.Rdata*
- *res/sim2/batch_constants_for_bandwidths.Rdata*
3. Run the R scripts ***simulation1.R*** and ***simulation2.R*** which will load the constants for bandwidths  and call functions in the folder ***FNS*** to compute the integrated mean square errors of the online and batch estimates as well as computing times. The corresponding results will be stored in the directory ***res/sim1*** and directory ***res/sim2***. 
5. Run the R scripts ***simu_figplot.R*** to generate **Figure 4-7**. 

As the bandwidth selection is not our focus, all procedures of estimating the constants for bandwidths in the simulations and data applications are collected in the R script ***supp-bandwidth_selection.R***. The corresponding results are stored in the directory *res*. One can load them directly when reproducing the numerical experiments.

#### Simulation 3

The R script ***Compare_Code/simuscript.R*** contains the code to compute the integrated mean square errors of different online nonparametric methods in the degenerated one-dimensional case.

The R script ***Compare_Code/figplot.R*** contains the code to generate **Figure 1** of the supplement.

### Data applications

The R scripts ***flight_preprocess.R*** contains the code to preprocess the raw csv data which can be downloaded from the above link. The preprocessed data are given in the Directory *datasets*.

The R scripts ***flight_main.R*** and ***credit_main.R*** contain the code which computes the online and batch estimates as well as computing time for the two datasets, respectively. 

The R scripts ***flight_figplot.R*** contains the code to generate **table 1** and **Figure 8** and ***credit_figplot.R*** contains the code to generate **table 1** and **Figure 8** contains the code to generate **table 2** and **Figure 9**. 
